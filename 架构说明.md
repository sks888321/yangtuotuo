# é¡¹ç›®æ¶æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ api/                    # APIå±‚ - ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ index.ts           # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ users.ts           # ç”¨æˆ·ç›¸å…³API
â”‚   â”œâ”€â”€ courses.ts         # è¯¾ç¨‹ç›¸å…³API
â”‚   â”œâ”€â”€ schedules.ts       # æ’è¯¾ç›¸å…³API
â”‚   â””â”€â”€ payments.ts        # ç¼´è´¹ç›¸å…³API
â”œâ”€â”€ components/             # Vueç»„ä»¶
â”‚   â”œâ”€â”€ HelloWorld.vue
â”‚   â”œâ”€â”€ Layout.vue
â”‚   â””â”€â”€ WeeklyCalendar.vue # å‘¨è¯¾ç¨‹è¡¨ç»„ä»¶
â”œâ”€â”€ router/                 # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ types/                  # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ storage.ts         # å­˜å‚¨å±‚ - æ–‡ä»¶è¯»å†™
â”œâ”€â”€ views/                  # é¡µé¢è§†å›¾
â”‚   â”œâ”€â”€ Courses.vue        # è¯¾ç¨‹ç®¡ç†
â”‚   â”œâ”€â”€ Dashboard.vue      # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ Payments.vue       # ç¼´è´¹ç®¡ç†
â”‚   â”œâ”€â”€ Schedule.vue       # æ’è¯¾ç®¡ç†
â”‚   â””â”€â”€ Users.vue          # ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ App.vue
â””â”€â”€ main.ts
```

## ğŸ—ï¸ æ¶æ„åˆ†å±‚

### 1. å­˜å‚¨å±‚ (Storage Layer)
**ä½ç½®**: `src/utils/storage.ts`

**èŒè´£**: 
- åªè´Ÿè´£æ–‡ä»¶çš„è¯»å†™æ“ä½œ
- å¤„ç† File System Access API å’Œ localStorage çš„åˆ‡æ¢
- æä¾›åº•å±‚å­˜å‚¨æ¥å£

**æ ¸å¿ƒAPI**:
```typescript
export const storageAPI = {
  read: getFromStorage,   // è¯»å–æ–‡ä»¶
  write: saveToStorage    // å†™å…¥æ–‡ä»¶
}

export const STORAGE_FILES = {
  USERS: 'users.json',
  COURSES: 'courses.json',
  SCHEDULES: 'schedules.json',
  PAYMENTS: 'payments.json'
}

export async function selectStorageDirectory() // é€‰æ‹©å­˜å‚¨ç›®å½•
```

**ç‰¹ç‚¹**:
- çº¯ç²¹çš„I/Oæ“ä½œ
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- è‡ªåŠ¨é™çº§æœºåˆ¶ï¼ˆFile System API â†’ localStorageï¼‰

---

### 2. APIå±‚ (Business Logic Layer)
**ä½ç½®**: `src/api/`

**èŒè´£**:
- å°è£…ä¸šåŠ¡é€»è¾‘
- æä¾›å¢åˆ æ”¹æŸ¥æ¥å£
- æ•°æ®éªŒè¯å’Œå¤„ç†

#### 2.1 ç”¨æˆ·API (`users.ts`)
```typescript
export const userAPI = {
  getAll()              // è·å–æ‰€æœ‰ç”¨æˆ·
  add(user)             // æ·»åŠ ç”¨æˆ·
  update(id, updates)   // æ›´æ–°ç”¨æˆ·
  delete(id)            // åˆ é™¤ç”¨æˆ·
  getById(id)           // æ ¹æ®IDè·å–
  getByRole(role)       // æ ¹æ®è§’è‰²è·å–
  init()                // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
}
```

#### 2.2 è¯¾ç¨‹API (`courses.ts`)
```typescript
export const courseAPI = {
  getAll()              // è·å–æ‰€æœ‰è¯¾ç¨‹
  add(course)           // æ·»åŠ è¯¾ç¨‹
  update(id, updates)   // æ›´æ–°è¯¾ç¨‹
  delete(id)            // åˆ é™¤è¯¾ç¨‹
  getById(id)           // æ ¹æ®IDè·å–
  getByTeacher(teacherId) // æ ¹æ®æ•™å¸ˆè·å–
  init()                // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
}
```

#### 2.3 æ’è¯¾API (`schedules.ts`)
```typescript
export const scheduleAPI = {
  getAll()                  // è·å–æ‰€æœ‰æ’è¯¾
  add(schedule)             // æ·»åŠ æ’è¯¾
  update(id, updates)       // æ›´æ–°æ’è¯¾
  delete(id)                // åˆ é™¤æ’è¯¾
  getByDateRange(start, end) // æ ¹æ®æ—¥æœŸèŒƒå›´è·å–
  getByTeacher(teacherId)   // æ ¹æ®æ•™å¸ˆè·å–
  getByStudent(studentId)   // æ ¹æ®å­¦ç”Ÿè·å–
  getByWeek(weekStart)      // æ ¹æ®å‘¨è·å–
  getByDate(date)           // æ ¹æ®æ—¥æœŸè·å–
  checkConflict(...)        // æ£€æŸ¥æ—¶é—´å†²çª
}
```

#### 2.4 ç¼´è´¹API (`payments.ts`)
```typescript
export const paymentAPI = {
  getAll()                  // è·å–æ‰€æœ‰ç¼´è´¹
  add(payment)              // æ·»åŠ ç¼´è´¹
  update(id, updates)       // æ›´æ–°ç¼´è´¹
  delete(id)                // åˆ é™¤ç¼´è´¹
  getByStudent(studentId)   // æ ¹æ®å­¦ç”Ÿè·å–
  getByCourse(courseId)     // æ ¹æ®è¯¾ç¨‹è·å–
  getByStatus(status)       // æ ¹æ®çŠ¶æ€è·å–
  getPendingCount()         // è·å–å¾…æ”¯ä»˜æ•°é‡
  getTotalAmount(status?)   // è®¡ç®—æ€»é‡‘é¢
}
```

---

### 3. è§†å›¾å±‚ (View Layer)
**ä½ç½®**: `src/views/` å’Œ `src/components/`

**èŒè´£**:
- ç”¨æˆ·ç•Œé¢å±•ç¤º
- ç”¨æˆ·äº¤äº’å¤„ç†
- è°ƒç”¨APIå±‚æ¥å£

**ä½¿ç”¨æ–¹å¼**:
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨APIå±‚
import { userAPI, courseAPI } from '../api'

const users = await userAPI.getAll()
await userAPI.add(newUser)

// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨å­˜å‚¨å±‚
import { storageAPI } from '../utils/storage'
const users = await storageAPI.read('users.json') // ä¸è¦è¿™æ ·åš
```

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
    â†“
è§†å›¾å±‚ (Vue Components)
    â†“
APIå±‚ (ä¸šåŠ¡é€»è¾‘)
    â†“
å­˜å‚¨å±‚ (æ–‡ä»¶I/O)
    â†“
æœ¬åœ°æ–‡ä»¶ / localStorage
```

### ç¤ºä¾‹æµç¨‹ï¼šæ·»åŠ ç”¨æˆ·

1. **è§†å›¾å±‚**: ç”¨æˆ·ç‚¹å‡»"æ·»åŠ ç”¨æˆ·"æŒ‰é’®
```typescript
// Users.vue
await userAPI.add(newUser)
```

2. **APIå±‚**: å¤„ç†ä¸šåŠ¡é€»è¾‘
```typescript
// api/users.ts
add: async (user: User) => {
  const users = await userAPI.getAll()
  users.push(user)
  await userAPI.save(users)
}
```

3. **å­˜å‚¨å±‚**: æ‰§è¡Œæ–‡ä»¶å†™å…¥
```typescript
// utils/storage.ts
await storageAPI.write(STORAGE_FILES.USERS, users)
```

4. **æ–‡ä»¶ç³»ç»Ÿ**: ä¿å­˜åˆ° `users.json`

---

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

### 1. **å…³æ³¨ç‚¹åˆ†ç¦»**
- å­˜å‚¨å±‚ä¸“æ³¨I/O
- APIå±‚ä¸“æ³¨ä¸šåŠ¡
- è§†å›¾å±‚ä¸“æ³¨ç•Œé¢

### 2. **æ˜“äºç»´æŠ¤**
- ä¿®æ”¹å­˜å‚¨æ–¹å¼åªéœ€æ”¹å­˜å‚¨å±‚
- ä¿®æ”¹ä¸šåŠ¡é€»è¾‘åªéœ€æ”¹APIå±‚
- äº’ä¸å½±å“

### 3. **å¯æ‰©å±•æ€§**
- è½»æ¾æ·»åŠ æ–°çš„æ•°æ®å®ä½“
- å®¹æ˜“æ‰©å±•æ–°åŠŸèƒ½
- æ”¯æŒåç«¯APIæ›¿æ¢

### 4. **ä»£ç å¤ç”¨**
- APIå±‚å¯è¢«å¤šä¸ªç»„ä»¶è°ƒç”¨
- é¿å…é‡å¤ä»£ç 

### 5. **ç±»å‹å®‰å…¨**
- TypeScriptç±»å‹å®šä¹‰ç»Ÿä¸€ç®¡ç†
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

---

## ğŸ”§ å¦‚ä½•æ‰©å±•

### æ·»åŠ æ–°çš„æ•°æ®å®ä½“

1. **å®šä¹‰ç±»å‹** (`types/index.ts`)
```typescript
export interface NewEntity {
  id: string
  name: string
  createdAt: string
}
```

2. **æ·»åŠ å­˜å‚¨æ–‡ä»¶** (`utils/storage.ts`)
```typescript
export const STORAGE_FILES = {
  // ...
  NEW_ENTITY: 'new-entity.json'
}
```

3. **åˆ›å»ºAPI** (`api/new-entity.ts`)
```typescript
export const newEntityAPI = {
  getAll: async () => await storageAPI.read(STORAGE_FILES.NEW_ENTITY),
  add: async (item) => { /* ... */ },
  // ...
}
```

4. **å¯¼å‡ºAPI** (`api/index.ts`)
```typescript
export { newEntityAPI } from './new-entity'
```

5. **åœ¨è§†å›¾ä¸­ä½¿ç”¨**
```typescript
import { newEntityAPI } from '../api'
const items = await newEntityAPI.getAll()
```

---

## ğŸš€ è¿ç§»åˆ°åç«¯API

å¦‚æœå°†æ¥éœ€è¦ä½¿ç”¨åç«¯æœåŠ¡å™¨ï¼Œåªéœ€ä¿®æ”¹APIå±‚ï¼š

```typescript
// api/users.ts - ä¿®æ”¹å‰ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
export const userAPI = {
  getAll: async () => await storageAPI.read(STORAGE_FILES.USERS)
}

// api/users.ts - ä¿®æ”¹åï¼ˆåç«¯APIï¼‰
export const userAPI = {
  getAll: async () => {
    const response = await fetch('/api/users')
    return response.json()
  }
}
```

è§†å›¾å±‚ä»£ç **å®Œå…¨ä¸éœ€è¦ä¿®æ”¹**ï¼

---

## ğŸ“ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **è§†å›¾å±‚åªè°ƒç”¨APIå±‚**
```typescript
import { userAPI } from '../api'
const users = await userAPI.getAll()
```

2. **APIå±‚å°è£…å®Œæ•´ä¸šåŠ¡é€»è¾‘**
```typescript
// ä¸è¦è®©è§†å›¾å±‚å¤„ç†å¤æ‚é€»è¾‘
export const userAPI = {
  addTeacher: async (teacherData) => {
    // éªŒè¯ã€è½¬æ¢ã€ä¿å­˜
    const teacher = { ...teacherData, role: 'teacher' }
    await userAPI.add(teacher)
  }
}
```

3. **ç»Ÿä¸€ä» api/index.ts å¯¼å…¥**
```typescript
import { userAPI, courseAPI, scheduleAPI } from '../api'
```

### âŒ é¿å…åšæ³•

1. **ä¸è¦åœ¨è§†å›¾å±‚ç›´æ¥ä½¿ç”¨å­˜å‚¨å±‚**
```typescript
// âŒ é”™è¯¯
import { storageAPI } from '../utils/storage'
const users = await storageAPI.read('users.json')
```

2. **ä¸è¦åœ¨APIå±‚å¤„ç†UIé€»è¾‘**
```typescript
// âŒ é”™è¯¯ - UIé€»è¾‘åº”è¯¥åœ¨è§†å›¾å±‚
export const userAPI = {
  addWithDialog: async (user) => {
    // ä¸è¦åœ¨è¿™é‡Œä½¿ç”¨ message.success()
  }
}
```

3. **ä¸è¦è·¨å±‚è°ƒç”¨**
```typescript
// âŒ é”™è¯¯ - è§†å›¾å±‚ä¸åº”ç›´æ¥è®¿é—®å­˜å‚¨å±‚
import { storageAPI } from '../utils/storage'
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å­˜å‚¨çš„æ•°æ®
```typescript
// æ§åˆ¶å°
import { storageAPI, STORAGE_FILES } from './utils/storage'
const users = await storageAPI.read(STORAGE_FILES.USERS)
console.log(users)
```

### æ¸…ç©ºæ•°æ®
```typescript
await storageAPI.write(STORAGE_FILES.USERS, [])
```

### é‡æ–°åˆå§‹åŒ–
```typescript
import { initAllData } from './api'
await initAllData()
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŠŸèƒ½è¯´æ˜.md](../åŠŸèƒ½è¯´æ˜.md) - å®Œæ•´åŠŸèƒ½ä»‹ç»
- [å¿«é€Ÿä½¿ç”¨æŒ‡å—.md](../å¿«é€Ÿä½¿ç”¨æŒ‡å—.md) - å¿«é€Ÿä¸Šæ‰‹
- [README.md](../README.md) - é¡¹ç›®æ¦‚è¿°
